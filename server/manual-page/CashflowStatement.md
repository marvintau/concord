### 现金流量表

在操作现金流量表之前，首先确保您已经上传了一份符合要求的**科目余额表**，否则会显示您需要上传其它数据。之后您需要上传一个在本地编辑好的**现流表编制明细**Excel文件。

您可以先在[这里](./CASHFLOW_STATEMENT_TEMPLATE.XLSX)下载一份模版文件，基于您的项目性质进行编辑，编辑好之后再进行上传。

### 基本操作

现金流量表也是一个级联表，您可以通过【展开/收拢】按钮来切换级联和完整显示。但是完整显示通常会更为直观。

表单主体为各个条目，右侧有一栏【编辑】。其中

1. ![create][create-record] 如果当前行是最末级，那么在它前面插入一个同级新条目。
2. ![add][add-child] 如果当前行存在下级，那么向它的下级插入一个新的条目。通常一个标题旁边会是这个图标。
3. ![cross][cross] 按钮为删除当前行的条目。

可修改的现流表条目。当鼠标悬停在条目内容上方时会高亮显示，并出现 ![modify][modify] 图标时，单击可进行修改。

---
### 编辑现流表条目

现流表条目使用了一套类似Excel的语法，为了支持带有变量的表示。这套语法目前仅为了实现现流表内的运算，尚未在更大的使用范围内进行测试。

当你点击一个现流表条目进行修改时，会出现**描述** (显示【在这里修改描述】的输入框) 和右侧的表达式栏。在**描述**一栏中，您可以输入任意文本。在表达式栏中则支持以下几种输入：

**纯数字/算数表达式**

完成时会进行运算并显示结果，例如：
```
8.00 -> 8.00
3.00 + 5 -> 8.00
12 - (2.5 + 3 * 0.5) -> 8.00
```

**变量和对变量的引用**

在运算过程中可以保存一些变量，使得后面的运算可以引用之前的运算结果。例如前后三个条目
```
one@12 - (2.5 + 3 * 0.5)  -> 显示的仍然是8.00
another@one + 4 -> 显示的是12.00
one+another -> 显示的是20.00
```

**对表的引用**

对表的引用格式较为复杂，引用格式如下：
```
[表名称]:路径1/路径2/.../路径3:字段1 + 字段2
```
其中字段之间的运算和带变量的表达式是一样的。例如
```
BALANCE:应交税费/应交增值税/销项税额:贷方 - 借方
```
特别需要说明，在编辑时提供了对路径的自动补全。系统会读取引用的表，并查看您此时输入的路径都有哪些子层的路径。在本例中，所谓的路径指的是逐级的科目名称。在 **通用设置** 中包含了一个名为 **科目别名** 的数据表，其中包含了等价的科目名称，如果您上传的科目余额表或其它数据表中含有意义相同，但名称不同的数据，在路径补全和计算的过程中，系统会从这个等价的科目名称中进行搜索。如果发现通过给定科目无法得出结果，但通过等价的名称可以，那么会按照等价名称所找到的数据进行后续计算。

**函数计算**

目前有两个函数，分别是SUB1和SUMSUB，SUB1是取子层条目中第一个条目的数值，SUMSUB是对所有子层条目的数值求和。

需要注意的是，目前为止这些函数都是为了满足计算需求而临时添加的，未来引入更复杂的计算时随时都会更改。您目前不应该使用函数来计算。

[create-record]: ./create-record.png
[add-child]: ./add-child.png
[cross]: ./cross.png
[modify]: ./modify.png

---

### 现流表条目的值

下图示例说明不同值的表示

![example](./example.png)

* 红色：不能识别的表达式。您可能输入了不符合上面列举的内容
* 黄色：表达式可以识别，但存在错误。比如
  * 数据表不存在
  * 科目名称，或者按其它路径没有找到记录
  * 使用了没有定义的变量
  * 使用了求和函数，但是它的子层数据中存在错误。注意它的计算值是按照正常值计算的。
* 蓝绿色：按给定变量没有找到对应的记录，但是按照可以替代的名称找到了记录。用蓝绿色标注出来，不影响运算。

下图示例特别说明校验的结果

![example](./example2.png)
* 黄色：校验结果不等，显示的数值是二者差的绝对值
* 绿色：校验结果相等，显示"EQUAL"

---

### 保存

确认无误后，点【保存至服务器】保存您的更改，否则所有的改动都会丢失。另外由于本系统不具备撤销功能，如果您作出了无法恢复的改动，请立刻刷新页面。